
> alive@1.0.0 test
> node test/smoke.test.js && node test_game_lifecycle.js && node test_support_pack.js && node check_integrity.js


????????? 1. JSON Data Files ??? Loading & Integrity ?????????
  ??? cities.json is valid JSON
  ??? cities.json has ???5 entries
  ??? cities.json[0] has required fields [id, name, country]
  ??? events.json is valid JSON
  ??? events.json has ???1 entries
  ??? events.json[0] has required fields [id]
  ??? buildings.json is valid JSON
  ??? buildings.json has ???1 entries
  ??? buildings.json[0] has required fields [id]
  ??? characters.json is valid JSON
  ??? characters.json has ???1 entries
  ??? game_assets.json is valid JSON
  ??? game_assets.json is a valid object
  ??? items.json is valid JSON
  ??? items.json has ???1 entries
  ??? transports.json is valid JSON
  ??? transports.json has ???1 entries

????????? 2. Strings / i18n Data ?????????
  ??? strings.js exists
  ??? Alive.strings loaded
  ??? English strings present
  ??? Russian strings present
  ??? EN has ???100 string keys (got 1066)
  ??? RU has ???100 string keys (got 1013)
  ??? EN has key "ui.gameTitle"
  ??? EN has key "ui.newLife"
  ??? EN has key "ui.continue"
  ??? EN has key "ui.nextYear"
  ??? EN has key "ui.age"
  ??? EN has key "ui.health"

????????? 3. Core Module Loading ?????????
  ??? player_core.js loaded
  ??? game.js loaded
  ??? storage.js loaded
  ??? monetization.js loaded
  ??? Alive.Player available
  ??? Alive.Player.createNew available
  ??? Alive.Game available
  ??? Alive.storage available
  ??? Alive.storage.save is function
  ??? Alive.storage.load is function
  ??? Alive.Monetization available

????????? 4. Game Initialization ?????????
  ??? new Game() succeeds
  ??? game.player is null before startNewLife
  ??? game.ended is false
  ??? game.phase is 'event'
  ??? game.currentYear is 2000
  ??? game.bestResults exists
  ??? game.lifeStats exists

????????? 5. startNewLife ??? Player Creation ?????????
  ??? startNewLife returns player
  ??? player.name = 'SmokeTestPlayer'
  ??? player.gender = 'M'
  ??? player.age = 0
  ??? player.alive = true
  ??? player.health in [0,100]
  ??? player.happiness in [0,100]
  ??? player.money > 0 (medium tier)
  ??? game.ended = false after start
  ??? game.failCause = null
  ??? game.isProcessingYear = false
  ??? game._adRewardInProgress = false
  ??? game.seenEventIds is empty array
  ??? game.eventQueue is empty array
  ??? Wealth tier "poor": money 100 in [50, 500]
  ??? Wealth tier "medium": money 2500 in [1000, 5000]
  ??? Wealth tier "rich": money 15000 in [10000, 50000]
  ??? Wealth tier "elite": money 100000 in [50000, 500000]

????????? 6. Year Progression ??? nextYear() ?????????
  ??? Age incremented by 1
  ??? currentYear incremented by 1
  ??? isProcessingYear reset to false after nextYear
  ??? Player still alive after 1 year
  ??? game.ended still false after 1 year
  ??? annualIncome is a number
  ??? annualExpenses is a number
  ??? health still in [0,100]
  ??? happiness still in [0,100]
  ??? stress still in [0,100]
  ??? nextYear is no-op when isProcessingYear=true

????????? 7. Save ??? Load Roundtrip ?????????
  ??? getState() returns object
  ??? getState().player exists
  ??? getState().player.name = 'SaveLoadTest'
  ??? getState().currentYear = 2005
  ??? storage.save() returns true
  ??? storage.hasSave() returns true after save
  ??? Raw save data exists in localStorage
  ??? Raw save parses as JSON
  ??? Save has version field
  ??? Save has timestamp field
  ??? Save has state field
  ??? Save has flags field
  ??? storage.load() returns object
  ??? game.load() returns true
  ??? Loaded player.name matches
  ??? Loaded player.gender matches
  ??? Loaded currentYear matches
  ??? Loaded player.age matches (5)
  ??? Loaded player.alive = true
  ??? ended flag roundtrips
  ??? phase roundtrips
  ??? gems roundtrip
  ??? Can advance year after load
  ??? storage.hasSave() returns false after clear

????????? 8. Player Stats & Economy ?????????
  ??? health clamped to 100
  ??? happiness clamped to 0
  ??? stress clamped to 100
  ??? modifyStat +30 health ??? 80
  ??? modifyStat capped at 100
  ??? modifyStat floored at 0
  ??? recalculateEconomy returns object
  ??? annualIncome is 0 when unemployed
  ??? annualExpenses > 0 (housing + food + health)
  ??? netWorth = money when no assets

????????? 9. 10-Year Simulation Smoke Run ?????????
  ??? Completed 10 year(s) without crash
  ??? Player age = 10 after 10 years
  ??? Player still alive after 10 years
  ??? currentYear = 2010
  ??? health in [0,100] at year 10
  ??? happiness in [0,100] at year 10
  ??? money is a finite number

????????? 10. Integrity Meta-Checks ?????????
  ??? startNewLife defined exactly once
  ??? revivePlayer defined exactly once
  ??? nextYear defined exactly once
  ??? All local <script src> in index.html exist on disk

??????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????
  RESULTS: 121 passed, 0 failed, 0 skipped
??????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????

--- startNewLife ??? basic creation ---
  ??? Returns player instance
  ??? Player name is set
  ??? Player gender is set
  ??? Game ended = false
  ??? failCause = null
  ??? phase = 'event'
  ??? eventQueue is empty
  ??? seenEventIds is empty

--- startNewLife ??? processing flag resets (from V1) ---
  ??? isProcessingYear reset to false
  ??? _adRewardInProgress reset to false

--- startNewLife ??? onboarding check (from V1) ---
  ??? isOnboarding = true for new player
  ??? onboardingStep = 0
  ??? isOnboarding stays false for veteran

--- startNewLife ??? analytics tracking (from V1) ---
  ??? Analytics.trackLifeStart called
  ??? Analytics receives player name

--- startNewLife ??? achievements hook (from V2) ---
  ??? achievements.onNewLifeStarted called

--- startNewLife ??? playerState (legacy/inheritance mode) ---
  ??? Legacy playerState: name set
  ??? Legacy playerState: age set

--- startNewLife ??? wealth tiers ---
  ??? Poor tier: money = 100
  ??? Rich tier: money = 15000
  ??? Elite tier: money = 100000
  ??? Medium tier: money = 2500

--- revivePlayer ??? basic behaviour ---
Player revived!
  ??? ended set to false after revive
  ??? failCause cleared
  ??? health set to 40 (diminished capacity)
  ??? happiness set to 40 (diminished capacity)

--- revivePlayer ??? one-time guard ---
Player revived!
  ??? First revive: flags.revivedOnce = true
node.exe : Player 
already revived once. 
No more second chances.
??????:1 ????:1
+ & "C:\Program 
Files\nodejs/node.exe" 
"C:\Users\Bekzat\AppDat
a\Roaming ...
+ ~~~~~~~~~~~~~~~~~~~~~
~~~~~~~~~~~~~~~~~~~~~~~
~~~~~~~~~~~~~~~~~~~~~~~
~~
    + CategoryInfo     
         : 
NotSpecified    : 
(Player already .    
..second chances.:S    
tring) [], RemoteEx    
ception
    + 
FullyQualifiedErr    
orId : NativeComman    
dError
 
  ??? Second revive: still ended

--- revivePlayer ??? does nothing if game not ended ---
  ??? No-op when not ended
  ??? health unchanged

--- No duplicate method definitions (meta-check) ---
  ??? startNewLife defined exactly once
  ??? revivePlayer defined exactly once

========================================
Result: 32 passed, 0 failed
========================================

--- Step 1: Initial state ??? no Support Pack ---
  ??? hasSupportPack starts false
  ??? aliveGame.monetization linked

--- Step 2: Purchase Support Pack (mock) ---
  ??? hasSupportPack = true after purchase

--- Step 3: Save game state ---
  ??? Save succeeded
  ??? Raw save data exists
  ??? flags.hasSupportPack = true in saved data

--- Step 4: Simulate app restart ??? new Monetization instance ---

--- Step 5: Load saved state and verify entitlement restoration ---
  ??? State loaded successfully
  ??? _pendingSupportPack flag set by load()
Monetization: Restored Support Pack from saved entitlement
  ??? New Monetization picks up deferred Support Pack
  ??? _pendingSupportPack cleaned up

--- Step 6: Verify interstitial ads are blocked ---
  ??? Interstitial ad NOT shown (Support Pack active)

--- Step 7: Verify interstitial works WITHOUT Support Pack ---
Monetization: MOCK Interstitial Ad
  ??? Interstitial ad shown when Support Pack is NOT active

--- Step 8: No static property leaks on Alive.Monetization ---
  ??? Alive.Monetization class has no hasSupportPack static prop

========================================
Result: 13 passed, 0 failed
========================================
???? Alive Project Integrity Check
   2026-02-26T12:54:31.511Z

=== Duplicate class method check ===
  ??? No duplicate class methods found across 34 JS files

=== Script source file check ===
  ??? All 31 local script sources exist

??? All checks passed!
